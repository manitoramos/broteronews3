var secondoffset=0;var processing_room=false;var simulate_winner=false;Number.prototype.format=function(n,x,s,c){var re='\\d(?=(\\d{'+(x||3)+'})+'+(n>0?'\\D':'$')+')',num=this.toFixed(Math.max(0,~~n));return(c?num.replace('.',c):num).replace(new RegExp(re,'g'),'$&'+(s||','));};var init=function(options){var self=this;$.extend(self,{settings:$.extend(true,{},{},options),log:function(msg){},accept_emitted:false,odometer:{el:false,od:false,init:function(){self.odometer.el=document.querySelector('#odometer');self.odometer.od=new Odometer({el:self.odometer.el,value:100,duration:1000,animation:"count",format:'',theme:'digital'});}},velocity:{init:function(){$('.small, .small-shadow').velocity({rotateZ:[0,-360]},{loop:true,duration:2000});$('.medium, .medium-shadow').velocity({rotateZ:-240},{loop:true,duration:2000});$('.large, .large-shadow').velocity({rotateZ:180},{loop:true,duration:2000});}},pnotify:{show:function(title,text,callbackClick){PNotify.desktop.permission();(new PNotify({title:title,text:text,hide:true,icon:false,desktop:{desktop:true,icon:"frontend/gfx/logo_pnotify_info_mini.png"}})).get().click(function(e){if($('.ui-pnotify-closer, .ui-pnotify-sticker, .ui-pnotify-closer *, .ui-pnotify-sticker *').is(e.target))return;callbackClick();});},success:function(title,text,callbackClick){PNotify.desktop.permission();(new PNotify({title:title,text:text,type:"success",hide:true,icon:false,desktop:{desktop:true,icon:"frontend/gfx/logo_pnotify_success_mini.png"}})).get().click(function(e){if($('.ui-pnotify-closer, .ui-pnotify-sticker, .ui-pnotify-closer *, .ui-pnotify-sticker *').is(e.target))return;callbackClick();});},error:function(title,text,callbackClick){PNotify.desktop.permission();(new PNotify({title:title,text:text,type:"error",hide:true,icon:false,desktop:{desktop:true,icon:"frontend/gfx/logo_pnotify_error_mini.png"}})).get().click(function(e){if($('.ui-pnotify-closer, .ui-pnotify-sticker, .ui-pnotify-closer *, .ui-pnotify-sticker *').is(e.target))return;callbackClick();});},info:function(title,text,callbackClick){PNotify.desktop.permission();(new PNotify({title:title,text:text,type:"info",hide:true,icon:false,desktop:{desktop:true,icon:"frontend/gfx/logo_pnotify_info_mini.png"}})).get().click(function(e){if($('.ui-pnotify-closer, .ui-pnotify-sticker, .ui-pnotify-closer *, .ui-pnotify-sticker *').is(e.target))return;callbackClick();});},notice:function(title,text,callbackClick){PNotify.desktop.permission();(new PNotify({title:title,text:text,type:"notice",hide:true,icon:false,desktop:{desktop:true,icon:"frontend/gfx/logo_pnotify_info_mini.png"}})).get().click(function(e){if($('.ui-pnotify-closer, .ui-pnotify-sticker, .ui-pnotify-closer *, .ui-pnotify-sticker *').is(e.target))return;callbackClick();});}},affix:{room:function(){$('#affix-room').affix({offset:{top:function(){if($(window).height()<$("#affix-room").height()){return 9999;}
return 200;}}}).on("affix.bs.affix",function(){self.affix.onResize();}).on("affixed.bs.affix",function(){}).on("affix-top.bs.affix",function(){self.affix.onResize();}).on("affixed-top.bs.affix",function(){}).on("affix-bottom.bs.affix",function(){}).on("affixed-bottom.bs.affix",function(){}).trigger("affix.bs.affix");if($(window).scrollTop()>=200){$('#affix-room').trigger("affix.bs.affix");}else{$('#affix-room').trigger("affix-top.bs.affix");}},players:function(){$('#affix-players').affix({offset:{top:function(){if($(window).height()<$("#affix-players").height()){return 9999;}
return 200;}}}).on("affix.bs.affix",function(){self.affix.onResize();}).on("affixed.bs.affix",function(){}).on("affix-top.bs.affix",function(){self.affix.onResize();}).on("affixed-top.bs.affix",function(){}).on("affix-bottom.bs.affix",function(){}).on("affixed-bottom.bs.affix",function(){}).trigger("affix.bs.affix");if($(window).scrollTop()>=200){$('#affix-players').trigger("affix.bs.affix");}else{$('#affix-players').trigger("affix-top.bs.affix");}},right:function(){$('#affix-right').affix({offset:{top:function(){if($(window).height()<$("#affix-right").height()){return 9999;}
return 200;}}}).on("affix.bs.affix",function(){self.affix.onResize();}).on("affixed.bs.affix",function(){}).on("affix-top.bs.affix",function(){self.affix.onResize();}).on("affixed-top.bs.affix",function(){}).on("affix-bottom.bs.affix",function(){}).on("affixed-bottom.bs.affix",function(){}).trigger("affix.bs.affix");if($(window).scrollTop()>=200){$('#affix-right').trigger("affix.bs.affix");}else{$('#affix-right').trigger("affix-top.bs.affix");}},onResize:function(){$('#affix-room').width($(".affix-room").width());$('#affix-players').width($(".affix-players").width());$('#affix-right').width($(".affix-right").width());var wH=$(window).height();if($(window).width()>1199){if($('#affix-right').hasClass("affix")){$("#affix-right #chat .chat-container").height(wH- 120);}else{$("#affix-right #chat .chat-container").height(wH- 295);}}else{$("#affix-right #chat .chat-container").height("auto");}}},lang:{},init:function(){self.lang=self.settings.lang;self.chat.scrollbar.init();self.menu.init();self.createCircle(431,431,0);$("#autologin").change(function(){var autologin,href;if($(this).attr("checked")){autologin="1";}else{autologin="0";}
href=$("#steam-login-url").attr("href").replace("autologin%3D1&","autologin%3D"+autologin+"&");$("#steam-login-url").attr("href",href);href=$("#steam-login-url").attr("href").replace("autologin%3D0&","autologin%3D"+autologin+"&");$("#steam-login-url").attr("href",href);});self.room.init();self.raffle.init();$(".AntiSpam").val("OK");self.bootstrap.init();self.socket.init();$(window).resize(function()
{self.log("self.init --> resize");self.affix.onResize();self.resizeCircle();if($(window).width()>1199){var panelH=$(window).height()- 220;$("#room-items").height(panelH);$(".affix-room").height(panelH);$("#affix-players").height(panelH);}else{$("#room-items").height("auto");$(".affix-room").height("auto");$("#affix-players").height("auto");}}).trigger("resize");$(window).load(function(){$("#left").mCustomScrollbar({theme:"minimal",scrollbarPosition:"outside",scrollInertia:0});$(".site").mCustomScrollbar({theme:"minimal-dark",scrollbarPosition:"inside",scrollInertia:0});$(".scrollbar").mCustomScrollbar({theme:"minimal-dark",scrollbarPosition:"inside",scrollInertia:0});});},setCookie:function(c_name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate()+ exdays);var c_value=escape(value)+((exdays==null)?"":";expires="+ exdate.toUTCString());document.cookie=c_name+"="+ c_value+";domain=."+location.hostname+";path=/";},getCookie:function(c_name){var i,x,y,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++){x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==c_name){return unescape(y);}}
return false;},removeCookie:function(cookie){self.setCookie(cookie,false,-1);},bootstrap:{init:function(){}},circle:{animate:function(to){$({value:self.circle.from}).animate({value:to},{duration:1000,easing:'swing',step:function()
{$(".knob").val(Math.ceil(this.value)).trigger('change');}});self.circle.from=to;},from:0,},resizeCircle:function(){var circle_container=$("#circle-container");var width=circle_container.width();self.createCircle(width,width,self.circle.from);},createCircle:function(width,height,value,max){var circle=$("#circle .circle");if(width>350){width=350;height=350;}
$("#circle").css({width:width,height:height});circle.html('<input class="knob">');$(".knob").knob({width:width,height:height,thickness:0.3,fgColor:"#217dce",bgColor:"#000",readOnly:true,displayInput:false,displayPrevious:false,font:"Roboto",min:0,max:self.settings.max_items,change:function(value){},release:function(value){},cancel:function(){},format:function(value){var p=value;value=parseFloat(self.room.price_all/self.room.count_items*value).toFixed(2);if(isNaN(value)){value=0;}
if(value>10){value=parseInt(value);}
var percent=parseFloat(p/self.settings.max_items*100).toFixed(2);return"";},draw:function(){if(this.$.data('skin')=='tron'){this.cursorExt=0.3;var a=this.arc(this.cv),pa,r=1;this.g.lineWidth=this.lineWidth;if(this.o.displayPrevious){pa=this.arc(this.v);this.g.beginPath();this.g.strokeStyle=this.pColor;this.g.arc(this.xy,this.xy,this.radius- this.lineWidth,pa.s,pa.e,pa.d);this.g.stroke();}
this.g.beginPath();this.g.strokeStyle=r?this.o.fgColor:this.fgColor;this.g.arc(this.xy,this.xy,this.radius- this.lineWidth,a.s,a.e,a.d);this.g.stroke();this.g.lineWidth=2;this.g.beginPath();this.g.strokeStyle=this.o.fgColor;this.g.arc(this.xy,this.xy,this.radius- this.lineWidth+ 1+ this.lineWidth*2/3,0,2*Math.PI,false);this.g.stroke();return false;}}});$(".knob").val(value).trigger('change');},room:{price_all:0,count_items:0,timer:$("#countdown-timer"),modalTimer:$("#modal-timer"),finished_rooms:{},init:function(){},setTimer:function(seconds,callback){var $this=this;$this.timer.countdown((moment().add(seconds,'seconds').format("YYYY/MM/DD HH:mm:ss")),function(event){$this.timer.html(event.strftime('%M:%S'));}).on('update.countdown',function(e){}).on('finish.countdown',function(e){callback("finish timer");});},setModalTimer:function(seconds,callback){var $this=this;$this.modalTimer.countdown((moment().add(seconds,'seconds').format("YYYY/MM/DD HH:mm:ss")),function(event){$this.modalTimer.html(event.strftime('%M:%S'));}).on('update.countdown',function(e){}).on('finish.countdown',function(e){callback("finish modalTimer");});}},items:{init:function(){},sort:function(by,t){var si=$(t).find(".si");if(si.hasClass("opened")){$("#dropbox").isotope({filter:"*"});$(".si").text(self.lang.user_items).removeClass("opened");}else{$(".si").removeClass("opened").text(self.lang.user_items);si.text("Hide").addClass("opened");$("#dropbox").isotope({filter:by});}}},raffle:{timer:$("#countdown-raffle-timer"),init:function(){var $this=this;$this.timer.countdown($this.timer.data('countdown'),function(event){$this.timer.html(moment(event.finalDate).fromNow());});},setTimer:function(seconds,callback){var $this=this;$this.timer.countdown((moment().add(seconds,'seconds').format("YYYY/MM/DD HH:mm:ss")),function(event){$this.timer.html(event.strftime('%m/%d/%y %I:%M %p %Z'));}).on('update.countdown',function(e){}).on('finish.countdown',function(e){callback("finish");});}},isotope:{players:false,dropbox:false,restart:function(){if(self.isotope.players&&self.isotope.players.data("isotope")){self.isotope.players.isotope("destroy").html("");}
if(self.isotope.dropbox&&self.isotope.dropbox.data("isotope")){self.isotope.dropbox.isotope("destroy").html("");}
self.isotope.dropbox=$('#dropbox').isotope({itemSelector:'.item',layoutMode:'fitRows',sortBy:'number',getSortData:{'number':'.number parseInt'},sortAscending:false,animationEngine:'css'});self.isotope.players=$('#rooms .room.active').isotope({itemSelector:'.item',layoutMode:'fitRows',getSortData:{'winner':'.winner parseInt','number':'.number parseInt'},sortBy:['number'],sortAscending:{winner:false,number:false},animationEngine:'css'});}},chat:{pull_right:0,scrollbar:{el:$("#chat .chat-container"),init:function(){var $this=this;$(window).load(function(){$this.el.mCustomScrollbar({theme:"dark-thin",scrollbarPosition:"inside",scrollInertia:0});});},bottom:function(){var $this=this;setTimeout(function(){$this.el.mCustomScrollbar('scrollTo','bottom');},1);}}},spinner:{scrollbar:{spinner:$("#spinner"),el:$("#spinner .spinner"),ul:$("#spinner .spinner ul"),ul_img:$("#spinner .spinner ul li img"),tmp:{},restart:function(){$("#spinner").addClass("active animated fadeInDown");$(".col-spinner").addClass("ohide animated fadeOutDown");var $this=this;var img_width=$this.el.find("img:first").width();var visible_width_half=$this.spinner.width()/2
var el_width=parseInt(img_width*$this.el.find("img").length);$this.ul.width(el_width);},hide:function(){var $this=this;$("#spinner").removeClass("animated fadeOutUp active");self.spinner.scrollbar.tmp={};$("#spinner .cont").css({'transform':'translate3d(0px, 0px, 0px)','transition':'all 0s ease 0s','backface-visibility':'hidden','width':'auto'}).html('');},showStats:function(){$("#spinner").removeClass("animated fadeInDown").addClass("animated fadeOutUp");$(".col-spinner").removeClass("animated fadeOutDown ohide").addClass("animated fadeInUp");self.spinner.scrollbar.tmp={};setTimeout(function(){self.spinner.scrollbar.hide();processing_room=false;},1000);},start:function(element,callback){$("#spinner").addClass("active animated fadeInDown");$(".col-spinner").addClass("ohide animated fadeOutDown");var $this=this;var img_width=$this.el.find("img:first").width();var offset=parseInt((img_width-10)/2);
offset=Math.floor((Math.random()*offset)+ 0);var offset=((Math.floor((Math.random()*100)+ 0))>=50)?offset:offset*-1;var visible_width_half=$this.spinner.width()/2
var el_width=parseInt(img_width*$this.el.find("img").length);$this.ul.width(el_width);$this.ul.css({'transform':'translate3d('+((((el_width/2)- visible_width_half)*-1)+ offset)+'px, 0px, 0px)','transition':'all 8s ease 0s','backface-visibility':'hidden'});var loc=10;var newLoc=0;var interval=setInterval(function(){newLoc=$this.getTransformOffset($this.ul);if(loc- newLoc>=95){loc=newLoc;self.spinner.emitSound();}},80);setTimeout(function(){clearInterval(interval);callback(element);},8000);},getTransformOffset:function($elem){var array=$elem.css('transform').split(',');if(array.length===6){return parseInt(array[4]);}else if(array.length===16){return parseInt(array[12]);}
return 0;},addUserAvatars:function(element,data,callback){var callbackTriggered=false;var c=1;var count=(data.shuffle.length*2+ 1);data.shuffle.forEach(function(openid){self.spinner.scrollbar.ul.append('<li><img src="'+data.users[openid].avatarfull+'"></li>');c=c+ 1;});self.spinner.scrollbar.ul.append('<li class="winner"><img src="'+data.users[data.winner_openid].avatarfull+'"></li>');data.shuffle.forEach(function(openid){self.spinner.scrollbar.ul.append('<li><img src="'+data.users[openid].avatarfull+'"></li>');c=c+ 1;if(c==count){var loaded_images_count=0;$("#spinner img").load(function(){loaded_images_count++;if(loaded_images_count==$("#spinner img").length){if(!callbackTriggered){callback(element);callbackTriggered=true;}}});}});setTimeout(function(){if(!callbackTriggered){callback(element);callbackTriggered=true;}},2500);}},emitSound:function(){if(self.settings.user.sounds_enabled){if(window.HTMLAudioElement){var snd=new Audio('');if(snd.canPlayType('audio/ogg')){snd=new Audio('frontend/sounds/spinner1.ogg');snd.volume=0.3;snd.play();}else if(snd.canPlayType('audio/mp3')){snd=new Audio('frontend/sounds/spinner1.mp3');snd.volume=.3;snd.play();}}}}},sound:{winner:function(){if(self.settings.user.sounds_enabled){if(window.HTMLAudioElement){var snd=new Audio('');if(snd.canPlayType('audio/mp3')){snd=new Audio('frontend/sounds/winner.mp3');snd.volume=0.1;}
snd.play();}}}},menu:{init:function(){var $this=this;$("a").click(function(){var page=$(this).data("page");if(page){var li=$("a."+ page).parent();var li_active=li.hasClass("active");$("#left li.active").removeClass("active");if(page&&page!="play"){if(li_active){$this.setHomepage();}else{$(".site.animated.bounceInLeft").removeClass("animated bounceInLeft").addClass("animated bounceOutLeft");$(".site-overlay").addClass("opened").fadeIn();$(".site."+ page).removeClass("animated bounceOutLeft").addClass("opened animated bounceInLeft");li.addClass("active");}}else if(page=="play"){$this.setHomepage();}
return false;}});},setHomepage:function(){$("#left li.active").removeClass("active");$(".play").parent().addClass("active");$(".site-overlay").removeClass("opened").hide();$(".site.opened").removeClass("animated bounceInLeft").addClass("animated bounceOutLeft");}},socket:{authAjaxHandler:false,socket:null,init:function(){if(self.settings.user.logged){self.setCookie("socket.io",self.settings.user.sid);}
var a=moment();var b=moment().startOf('day');var minutes=a.diff(b,"minutes");var socket=window.socket=io(self.settings.websocket,{transports:["websocket","polling"],query:"hash="+self.settings.user.hash+"&utcOffset="+ moment().utcOffset()+"&minutes="+ minutes});self.socket.socket=socket;var chat=$("#chat");var chat_msg_input=chat.find(".chat-message");var chat_body=chat.find(".messages");var chat_msg_template=$("#chat-msg-template").html();if(chat_msg_template){var chat_msg_template=Handlebars.compile(chat_msg_template);}
if(self.settings.user.logged){var user=self.settings.user;socket.on('connect',function(){console.log("connected to socket");socket.emit('get:auth',user);});socket.on('delete:msg',function(data){$(".msg"+ data.msg_id).remove();});socket.on('get:auth',function(data){if(!self.socket.authAjaxHandler){self.socket.authAjaxHandler=$.ajax({url:"/index.php?getSid",type:"GET",async:true,success:function(sid){if(data.sid==sid&&sid){console.log("user authorized");$("#accept-checkbox").change(function(){$("#accept-label").removeClass("animated shake error");});$("#lobbyAcceptModal button.btn").click(function(){if(!self.accept_emitted){if($(this).hasClass("btn-accept")){if($("#accept-checkbox").prop("checked")){socket.emit('queue:items:accepted',{accepted:1});self.accept_emitted=true;$('#lobbyAcceptModal').modal('hide');}else{$("#accept-label").addClass("animated shake error");}}else if($(this).hasClass("btn-deceline")){socket.emit('queue:items:accepted',{accepted:0});self.accept_emitted=true;$('#lobbyAcceptModal').modal('hide');$("#accept-label").removeClass("animated shake error");}}});$(".trade-url-area").each(function(){var area=$(this);var trade_url=area.find(".trade-url");trade_url.submit(function(){trade_url.find("button").button('loading');var url=trade_url.find(".trade-url-input").val();if(url!=""){$.ajax({url:"/ajax/",type:"POST",data:{steam_trade_url:url,openid:user.openid},async:true,success:function(response){if(response){if(area.data("hide")){area.slideUp();}
self.pnotify.success(self.lang.success,self.lang.your_trade_success,function(){});$(".trade-url-input").val(url);}else{self.pnotify.error(self.lang.error,self.lang.your_trade_error,function(){});}},complete:function(){trade_url.find("button").button('reset');}});}else{trade_url.find("button").button('reset');}
return false;});});}else{self.socket.disconnect();}},complete:function(){self.socket.authAjaxHandler=false;}});}});socket.on('user:banned',function(data){alert("You were banned from the site.");});socket.on('trade:url',function(response){if(response.responseCode){$(".alert-trade-url").alert("close");}else{$("#trade-url").find("button").button('reset');}});socket.on('queue:items:accept',function(response){self.pnotify.success(self.lang.success,self.lang.your_items_success,function(){});});socket.on('queue:items:prompt',function(response){var modal=$('#lobbyAcceptModal').on("hide.bs.modal",function(){$("#accept-label").removeClass("animated shake error");$("#accept-checkbox").prop("checked",false);$(".modal-backdrop").remove();});if(!modal.hasClass("in")){self.accept_emitted=false;var items=modal.find(".items").html(response.user_count_items);var price=modal.find(".price").html("$"+ response.user_price_all);self.room.setModalTimer(response.date_finish- moment().unix()+ secondoffset,function(){modal.modal('hide');});modal.modal('show');}});socket.on('queue:message:decelineoffer',function(response){console.log("queue:message:decelineoffer");self.pnotify.error(self.lang.items_not_accepted,self.lang.decelineoffer[response.msg_code],function(){});});}
chat.submit(function(){if(chat_msg_input.val()&&self.settings.user.logged){socket.emit('chat:send',{msg:chat_msg_input.val(),user:{openid:self.settings.user.openid}});chat_msg_input.val("");if(!self.settings.admin.logged){chat.find("button").button("loading");setTimeout(function(){chat.find("button").button("reset");},5001);}}
return false;});function addChatMessage(data){data.pull_right=(data.user.openid==self.settings.user.openid)?1:0;data.date=(moment(data.date).seconds(secondoffset)>moment())?moment().fromNow():moment(data.date).seconds(secondoffset).fromNow();data.admin_logged=self.settings.admin.logged;chat_body.append(chat_msg_template(data));self.chat.pull_right=self.chat.pull_right+ 1;self.chat.scrollbar.bottom();}
if(chat_msg_template){socket.on('chat:send',function(data){addChatMessage(data);});socket.on('chat:historysend',function(historysend){if(historysend){for(var i in historysend){addChatMessage(historysend[i]);}}});}
var history_template=$("#history-template").html();var history_template=Handlebars.compile(history_template);var winner_row_template=$("#winner-row-template").html();var winner_row_template=Handlebars.compile(winner_row_template);Handlebars.registerHelper('list',function(items,options){var str="";if(items){items.forEach(function(item){str+='<img src="https://steamcommunity-a.akamaihd.net/economy/image/class/730/'+item.classid+'/70fx58f" data-toggle="tooltip" data-placement="top" data-container="body" title="'+item.name+'($'+item.price+')">';});}
return str;});socket.on('count_games_today',function(data){$("#games-today").text(parseFloat(data).format(0,3,' ','.'));});socket.on('biggest_win_today',function(value){});socket.on('count_users_online',function(data){console.log("count_users_online");console.log(data);});socket.on('servertime',function(data){var remoteTime=moment(data);var serverTime=moment();var serverTimeZoneOffset=serverTime.utcOffset();var secondsOffset=serverTime.diff(remoteTime,'seconds')-(remoteTime.utcOffset()- serverTimeZoneOffset);secondoffset=serverTime.diff(remoteTime,'seconds')-(remoteTime.utcOffset()- serverTimeZoneOffset);});socket.on('emit:data',function(data){$("#users-online").text(parseFloat(data.count_users_online).format(0,3,' ','.'));if(data.raffle){$("#raffle").show();$("#raffle-name").text(data.raffle.item.name);$("#raffle-img").attr("src","https://steamcommunity-a.akamaihd.net/economy/image/class/730/"+data.raffle.item.assetid+"/120fx90f");self.raffle.setTimer(data.raffle.timer.date_finish- moment().unix()+ secondoffset,function(callback){});}else{$("#raffle").hide();}
if(data.game_history){$("#history").html("");$(".tooltip").remove();data.game_history.forEach(function(room){room.date_humanize=moment(room.date_create_time).fromNow();$("#history").append(history_template(room));});$('#history .footer img').tooltip();}
if(data.biggest_win){$("#biggest-win").text("$"+ parseFloat(data.biggest_win).format(2,3,' ','.'))}
if(data.top_players){$("#top-players-tbody").html("");var counter=1;data.top_players.forEach(function(stat){stat.counter=counter;stat.is_top=(counter<=3)?1:0;$("#top-players-tbody").append(winner_row_template(stat));counter=counter+1;});}});socket.on('emit:user:data',function(data){});var rooms=$("#rooms");if(rooms.length){var room_template=$("#room-template").html();var room_template=Handlebars.compile(room_template);var room_items={};var room_users={};self.isotope.restart();var room_can_be_updated=true;function createRoom(room){$("#affix-players .row .desc .right.hide").removeClass("hide");$("#affix-players .row .desc .room-price").addClass("hide");$(".ohide").removeClass("ohide");$("#circle").removeClass("win animated bounce");$("#room-user-items").text("0/"+ room.config.max_items);$("#room-id, #round-hash").removeClass("hide");$("#room-id").text("#"+ room.room);self.circle.animate(0);if(room.timer.active){self.room.setTimer(room.timer.seconds,function(callback){if(callback=="finish"){}});}
room_items={};room_users={};var context={id:room.id};$("#rooms .room.active").removeClass("active");$("#rooms").html(room_template(context));$("#room-price").html("$0.00");if(self.isotope.players){self.isotope.restart();}}
function sly(){(function(){var $frame=$('#centered');var $wrap=$frame.parent();$frame.sly({horizontal:1,itemNav:'centered',smart:1,activateOn:'click',mouseDragging:0,touchDragging:1,releaseSwing:1,startAt:4,scrollBar:$wrap.find('.scrollbar'),scrollBy:0,speed:1000,elasticBounds:0,easing:'easeOutCirc',dragHandle:1,dynamicHandle:1,clickBar:0,cycleBy:'items',cycleInterval:500,prev:$wrap.find('.prev'),next:$wrap.find('.next')});$frame.sly('resume');}());}
socket.on('room:winner',function(data){});socket.on('room:updatetimer',function(data){self.room.setTimer(data.seconds,function(callback){if(callback=="finish"){}});});var room_user_template=$("#room-user-template").html();var room_user_template=Handlebars.compile(room_user_template);var item_template=$("#item-template").html();var item_template=Handlebars.compile(item_template);function getItemElement($item){var $item=$($item);return $item;}
var user_room_panel_template=$("#user-room-panel-template").html();var user_room_panel_template=user_room_panel_template?Handlebars.compile(user_room_panel_template):false;socket.on('room:update',function(data){if(!self.room.finished_rooms[data.room]&&!processing_room){if(!data.processing_room&&simulate_winner){data.winner_openid="76561197992416988";}
if(data.winner_openid){processing_room=true;if(!simulate_winner){self.room.finished_rooms[data.room]=true;}}
self.settings.max_items=data.config.max_items;self.resizeCircle();if(room_can_be_updated){var room=$("#r"+ data.room);if(!room.length){createRoom(data);room=$("#r"+ data.room);}
if(self.settings.preloader){self.settings.preloader=false;$(".velocity").fadeOut(500);$(window).trigger("resize");}
var me=data.users[self.settings.user.openid];$(".blink_me."+ data.room).removeClass("blink_me "+ data.room);for(var i in data.items){var item=data.items[i];if(!room_items[item.id]){var $newItems=item_template({width:100,height:100,classid:item.classid,price:item.price,openid:item.user_openid,name:item.name,sort:parseInt(item.price*100)});self.isotope.dropbox.isotope('insert',$($newItems));room_items[item.id]=true;}}
if(data.active||true){self.room.price_all=data.price_all;self.room.count_items=data.count_items;system.circle.animate(data.count_items);if(data.timer.started&&!data.winner_openid){self.room.timer.fadeIn(1000)}else{self.room.timer.hide();}
if(!me){var me={count_items:0,percent:0}}
if(me){if(user_room_panel_template){$("#user-room-panel").html(user_room_panel_template({count_user_items:me.count_items,room:{max_items:data.config.max_items,max_user_items:data.config.max_user_items,min_user_items:data.config.min_user_items,min_user_items_value:parseFloat(data.config.min_user_items_value).toFixed(2)},me:{percent:me.percent}}));}
$("#room-user-items").text(data.count_items+"/"+ data.config.max_items);}}
if(room.length){if(data.winner_openid){self.spinner.scrollbar.hide();}
if(simulate_winner){data.shuffle=["76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561198144844479","76561198144844479","76561197992416988","76561197992416988","76561198144844479","76561198144844479","76561197992416988","76561198144844479","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561198144844479","76561197992416988","76561198144844479","76561198144844479","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561198144844479","76561198144844479","76561197992416988","76561197992416988","76561198144844479","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561197992416988","76561197992416988","76561198144844479","76561197992416988","76561198144844479","76561197992416988","76561197992416988","76561198144844479","76561198144844479","76561198144844479","76561198144844479","76561198144844479","76561197992416988","76561197992416988","76561197992416988"];data.users={"76561197992416988":{name:"Safe",url:"Safe",percent:80,price_all:110,count_items:10,openid:"76561197992416988",price_history:[10],avatarfull:"http://cdn.akamai.steamstatic.com/steamcommunity/public/images/avatars/37/374c9dabdaf6aec78ee59c900c5c5e3e8501945c_full.jpg?a="+ Math.floor((Math.random()*99999)+ 0),avatar:"http://cdn.akamai.steamstatic.com/steamcommunity/public/images/avatars/37/374c9dabdaf6aec78ee59c900c5c5e3e8501945c_full.jpg?a="+ Math.floor((Math.random()*99999)+ 0)},"76561198144844479":{name:"Test",url:"Test",percent:20,price_all:10,count_items:10,openid:"76561198144844479",price_history:[10],avatarfull:"http://cdn.akamai.steamstatic.com/steamcommunity/public/images/avatars/71/71b7561be8d02480fa59bbc6dfca5a0e03ae4873_full.jpg?a="+ Math.floor((Math.random()*99999)+ 0),avatar:"http://cdn.akamai.steamstatic.com/steamcommunity/public/images/avatars/71/71b7561be8d02480fa59bbc6dfca5a0e03ae4873_full.jpg?a="+ Math.floor((Math.random()*99999)+ 0)}};}
for(var i in data.users){var user=data.users[i];var element=room.find(".u"+ user.openid);if(element.length){element.find('.progress .progress-bar').attr('data-transitiongoal',user.percent).progressbar({display_text:'fill',use_percentage:true});element.find(".price_all").text("$"+ parseFloat(user.price_all).format(2,3,' ','.'));element.find(".count_items").text(user.count_items);element.find(".number").text((user.price_all.toFixed(2)*100));self.isotope.players.isotope('updateSortData').isotope();}else{var context={openid:user.openid,avatar:user.avatar,count_additions:user.price_history.length,price_all:"$"+ parseFloat(user.price_all).format(2,3,' ','.'),name:user.name,count_items:user.count_items,url:user.url,sort:(user.price_all.toFixed(2)*100)};var RoomUserTemplate=room_user_template(context);self.isotope.players.isotope('insert',$(RoomUserTemplate));var element=room.find(".u"+ user.openid);element.find('.progress .progress-bar').attr('data-transitiongoal',user.percent).progressbar({display_text:'fill',use_percentage:true});}
if(i==data.winner_openid){self.spinner.scrollbar.addUserAvatars(element,data,function(element){self.spinner.scrollbar.start(element,function(element){element.addClass("win").find(".winner").text(data.winner_openid);element.find(".name").text("Winner");element.find(".skins").text(data.users[data.winner_openid].name);element.find(".right").addClass("hide");element.find(".room-price").removeClass("hide").text("$"+ parseFloat(data.price_all).format(2,3,' ','.'));self.isotope.players.isotope({sortBy:"winner"});self.room.timer.hide();var circle=$("#circle");circle.addClass("win animated bounce").find(".white h2").text(data.users[data.winner_openid].name);circle.find(".white h4").text("$"+ parseFloat(data.price_all).format(2,3,' ','.')+" - "+ parseFloat(data.users[data.winner_openid].percent).format(2,3,' ','.')+"%");$("#room-user-items").addClass("ohide");self.spinner.scrollbar.ul.find(".winner").addClass("animated flip");if(data.winner_openid==self.settings.user.openid){self.sound.winner();}
$("#games-today").text(parseFloat(parseInt($("#games-today").html())+1).format(0,3,' ','.'));setTimeout(function(){self.spinner.scrollbar.showStats();$("title").text(self.settings.title);},2000);});});}
var amount=parseFloat(data.price_all).format(2,3,' ','.');$("#room-price").text("$"+ amount).fadeIn(2000);$("title").text("$"+ amount+" "+ self.settings.title);if(element.data("count-additions")<user.price_history.length&&!data.winner_openid){element.addClass("blink_me "+ data.room);}
element.data("count-additions",user.price_history.length);}}else{}}else{}}else if(processing_room){console.log("MISSING.ROOM");}});}},disconnect:function(){self.removeCookie("socket.io");self.socket.io.emit("forceDisconnect");}},admin:{banUser:function(openid){if(confirm("Jestes pewien ze chcesz zbanowac uzytkownika?")){if(self.settings.user.logged&&self.settings.user.openid!=openid){system.socket.socket.emit('ban:user',{"openid":openid});}else{alert("Jakim trzeba byc kretynem zeby sprobowac siebie zabanowac? :D");}}},unbanUser:function(openid){if(confirm("Jestes pewien ze chcesz odbanowac uzytkownika?")){system.socket.socket.emit('unban:user',{"openid":openid});}},deleteMsg:function(msg_id){system.socket.socket.emit('delete:msg',{"msg_id":msg_id});}}});return self;};var system={};